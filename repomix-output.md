This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repomix on: 2025-08-12 14:21:53

# File Summary

## Purpose:

This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

## File Format:

The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
   a. A header with the file path (## File: path/to/file)
   b. The full contents of the file in a code block

## Usage Guidelines:

- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

## Notes:

- Some files may have been excluded based on .gitignore rules and Repomix's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

## Additional Information:

For more information about Repomix, visit: https://github.com/andersonby/python-repomix


# Repository Structure

```
.gitignore
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
README.md
src
  app
    api
      sheets
        route.ts
      soundcloud-artwork
        route.ts
    globals.css
    heatmaps
      page.tsx
    layout.tsx
    list
      page.tsx
    page.tsx
    suggest
      page.tsx
  components
    AppShell.tsx
    CommandBar.tsx
    Header.tsx
    icons.tsx
    NowPlayingBar.tsx
    PlayerModal.tsx
    ScrollTopFab.tsx
    Thumb.tsx
    ui.tsx
  config.ts
  context
    PlayerProvider.tsx
tsconfig.json
```

# Repository Files


## .gitignore

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
```

## eslint.config.mjs

```text
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];

export default eslintConfig;
```

## next.config.ts

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
```

## package.json

```json
{
  "name": "website-tga",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@tanstack/react-virtual": "^3.13.12",
    "framer-motion": "^12.23.12",
    "html-to-image": "^1.11.13",
    "next": "15.4.6",
    "papaparse": "^5.5.3",
    "react": "19.1.0",
    "react-dom": "19.1.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/papaparse": "^5.3.16",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.4.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
```

## postcss.config.mjs

```text
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
```

## README.md

````markdown
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
````

## src/app/api/sheets/route.ts

```typescript
// app/api/sheets/route.ts
import { NextResponse } from "next/server";

// register tabs: use your two CSV links
const TABS = [
  {
    key: "list",
    url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRexqa-1vfj-JdFSSFUjWycho-00d5rLdS76eBgvCbruyvtcVIIom-VM52SvfuhLg-CeHLRp2I6k5B2/pub?gid=950522831&single=true&output=csv",
    map: "list" as const,
  },
  {
    key: "genres", // dimension table with labels + explanations
    url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRexqa-1vfj-JdFSSFUjWycho-00d5rLdS76eBgvCbruyvtcVIIom-VM52SvfuhLg-CeHLRp2I6k5B2/pub?gid=1479050239&single=true&output=csv",
    map: "genres" as const,
  },
];

export const dynamic = "force-dynamic";

// tiny csv parser
function parseCSV(t: string) {
  const out: string[][] = []; let row: string[] = [], cell = "", q = false;
  for (let i = 0; i < t.length; i++) {
    const ch = t[i], nx = t[i + 1];
    if (q) { if (ch === '"' && nx === '"') { cell += '"'; i++; } else if (ch === '"') q = false; else cell += ch; }
    else { if (ch === '"') q = true; else if (ch === ",") { row.push(cell); cell = ""; }
      else if (ch === "\n") { row.push(cell); out.push(row); row = []; cell = ""; }
      else if (ch !== "\r") cell += ch; }
  }
  if (cell.length || row.length) { row.push(cell); out.push(row); }
  return out.filter(r => r.some(x => (x || "").trim().length));
}

// helpers
const norm = (s: string) => (s || "").trim();
const lower = (s: string) => norm(s).toLowerCase();
const idx = (hdrs: string[], names: string[]) => {
  const H = hdrs.map(h => lower(h));
  for (const n of names) { const i = H.indexOf(n); if (i >= 0) return i; }
  return -1;
};
const pick = (cells: string[], i: number) => (i >= 0 ? norm(cells[i] || "") : "");

// fetch one tab
async function fetchTab(url: string) {
  const res = await fetch(url, { redirect: "follow", cache: "no-store", headers: { accept: "text/csv,*/*" } });
  if (!res.ok) throw new Error(`fetch failed ${res.status}`);
  const text = await res.text();
  const mat = parseCSV(text);
  if (!mat.length) return { headers: [], rows: [] as string[][] };

  // google export often has an empty spacer row between title and headers
  const headers = mat[0];
  const body = mat.slice(1);
  return { headers, rows: body };
}

// map "list" to your current Row shape so UI does not change
function map_list(headers: string[], body: string[][]) {
  const iSet  = idx(headers, ["set","dj set","mix","title","titel","naam"]);
  const iGen  = idx(headers, ["classification","genre","label","stijl","genre label"]);
  const iSc   = idx(headers, ["soundcloud","sc","soundcloud url","soundcloud_link"]);
  const iYt   = idx(headers, ["youtube","yt","youtube url","youtube_link"]);
  const iTier = idx(headers, ["tier","rating","s","score"]);

  return body.map(cells => {
    const set = pick(cells, iSet); if (!set) return null;
    return {
      set, // keep property name "set" for compatibility
      classification: pick(cells, iGen) || null,
      soundcloud: pick(cells, iSc) || null,
      youtube: pick(cells, iYt) || null,
      tier: pick(cells, iTier) || null,
    };
  }).filter(Boolean);
}

// map "genres" dim table to { label, explanation }
function map_genres(headers: string[], body: string[][]) {
  const iLbl = idx(headers, ["label","genre","classification","naam","code"]);
  const iExp = idx(headers, ["explanation","description","beschrijving","omschrijving","uitleg","notes"]);
  return body.map(cells => ({
    label: pick(cells, iLbl),
    explanation: pick(cells, iExp),
  })).filter(r => r.label);
}

// generic object map if you ever add more dims
function map_raw(headers: string[], body: string[][]) {
  const keys = headers.map(norm);
  return body.map(cells => Object.fromEntries(keys.map((k, i) => [k, norm(cells[i] || "")])));
}

// cache
type CacheVal = { ts: number; payload: any };
const TTL = 5 * 60 * 1000;
const g = globalThis as any; g.__sheetCache ||= new Map<string, CacheVal>();
const getCache = (k: string) => { const v = g.__sheetCache.get(k) as CacheVal | undefined; return v && Date.now() - v.ts < TTL ? v.payload : null; };
const setCache = (k: string, payload: any) => g.__sheetCache.set(k, { ts: Date.now(), payload });

// GET /api/sheets?tabs=list,genres
export async function GET(req: Request) {
  try {
    const url = new URL(req.url);
    const only = (url.searchParams.get("tabs") || "").split(",").map(s => s.trim()).filter(Boolean);
    const wanted = only.length ? TABS.filter(t => only.includes(t.key)) : TABS;

    const cacheKey = `tabs:${wanted.map(t => t.key).sort().join(",")}`;
    const cached = getCache(cacheKey);
    if (cached) return NextResponse.json(cached, { headers: { "Cache-Control": "no-store" } });

    const entries = await Promise.all(wanted.map(async t => {
      const { headers, rows } = await fetchTab(t.url);
      let data: any[];
      if (t.map === "list") data = map_list(headers, rows);
      else if (t.map === "genres") data = map_genres(headers, rows);
      else data = map_raw(headers, rows);
      return [t.key, data] as const;
    }));

    const payload = { ok: true, updatedAt: new Date().toISOString(), data: Object.fromEntries(entries) };
    setCache(cacheKey, payload);
    return NextResponse.json(payload, { headers: { "Cache-Control": "no-store" } });
  } catch (e: any) {
    return NextResponse.json({ ok: false, error: String(e?.message || e) }, { status: 500 });
  }
}
```

## src/app/api/soundcloud-artwork/route.ts

```typescript
// src/app/api/soundcloud-artwork/route.ts
import { NextResponse } from "next/server";

type CacheVal = { ts: number; val: string | null };
const TTL = 10 * 60 * 1000;
const g = globalThis as any;
g.__scArtCache ||= new Map<string, CacheVal>();

function getCached(key: string) {
  const hit = g.__scArtCache.get(key) as CacheVal | undefined;
  if (!hit) return null;
  if (Date.now() - hit.ts > TTL) return null;
  return hit.val;
}
function setCached(key: string, val: string | null) {
  g.__scArtCache.set(key, { ts: Date.now(), val });
}

export async function GET(req: Request) {
  try {
    const url = new URL(req.url);
    const trackUrl = url.searchParams.get("url");
    if (!trackUrl || !/^https?:\/\/(www\.)?soundcloud\.com\//i.test(trackUrl)) {
      return NextResponse.json({ artwork: null }, { status: 400 });
    }

    const key = trackUrl;
    const cached = getCached(key);
    if (cached !== null) {
      return NextResponse.json({ artwork: cached }, { headers: { "Cache-Control": "no-store" } });
    }

    const res = await fetch(
      `https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(trackUrl)}`,
      { headers: { accept: "application/json" } }
    );
    if (!res.ok) {
      setCached(key, null);
      return NextResponse.json({ artwork: null }, { status: 200 });
    }
    const data = (await res.json()) as { thumbnail_url?: string };
    const artwork = data?.thumbnail_url || null;
    setCached(key, artwork);
    return NextResponse.json({ artwork }, { headers: { "Cache-Control": "no-store" } });
  } catch (e: any) {
    return NextResponse.json({ artwork: null }, { status: 200 });
  }
}
```

## src/app/globals.css

```css
@import "tailwindcss";

/* light base */
html, body { height: 100%; }
body {
  min-height: 100svh;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-size: 15px;
  line-height: 1.75;
}

/* media defaults */
img, video { max-width: 100%; height: auto; display: block; }

/* focus */
:focus-visible { outline: 2px solid rgba(37,99,235,.35); outline-offset: 2px; }
```

## src/app/heatmaps/page.tsx

```text
'use client';

import React, { useEffect, useMemo, useRef, useState } from 'react';
import Papa, { ParseResult } from 'papaparse';
import * as htmlToImage from 'html-to-image';

type Rating = 'nahh' | 'ok' | 'hot' | 'blazing' | '';
type Row = {
  festival: string;  // full title to show
  date: string;      // YYYY-MM-DD
  stage: string;
  stage_order?: string | number;
  artist: string;
  start: string;     // HH:MM
  end: string;       // HH:MM
  rating?: string | null;
};

const COLORS = {
  unrated: '#E7E5E4',
  nahh:    '#8AA3FF',
  ok:      '#FEF0B8',
  hot:     '#FF9D2E',
  blazing: '#E7180B',
};

// rails and ticks
const TIME_W = 96;          // width of the left time rail
const TICK_W = 12;          // horizontal tick length inside time rail
const LABEL_GAP = 10;       // space between tick end and time label

const CARD_BORDER = 'border border-white shadow-[0_1px_2px_rgba(0,0,0,0.06)] rounded-md';

const norm = (v?: string) => (v ?? '').replace(/\u00a0/g, ' ').replace(/\s+/g, ' ').trim();
const toMin = (t: string) => {
  const s = norm(t);
  const [h, m] = s.split(':').map(n => parseInt(n, 10));
  return (isNaN(h) ? 0 : h) * 60 + (isNaN(m) ? 0 : m);
};
const clamp = (n: number, min: number, max: number) => Math.max(min, Math.min(max, n));
const parseDate = (d: string) => Date.parse(norm(d));
const bucketFromRating = (s?: string | null): Rating => {
  const v = norm(s).toLowerCase();
  if (v === 'nahh' || v === 'nah' || v === 'blue') return 'nahh';
  if (v === 'ok'   || v === 'yellow') return 'ok';
  if (v === 'hot'  || v === 'orange') return 'hot';
  if (v === 'blazing' || v === 'red') return 'blazing';
  return '';
};

type Group = { title: string; date: string; rows: Row[]; key: string };

export default function HeatmapsPage() {
  const DEFAULT_CSV =
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vRexqa-1vfj-JdFSSFUjWycho-00d5rLdS76eBgvCbruyvtcVIIom-VM52SvfuhLg-CeHLRp2I6k5B2/pub?gid=116583245&single=true&output=csv';
  const CSV_URL =
    typeof window !== 'undefined'
      ? new URLSearchParams(location.search).get('csv') || DEFAULT_CSV
      : DEFAULT_CSV;

  const [rows, setRows] = useState<Row[]>([]);
  const [pxPerMin, setPxPerMin] = useState(1.0);
  const [err, setErr] = useState<string | null>(null);
  const refs = useRef<Record<string, HTMLDivElement | null>>({});

  useEffect(() => {
    Papa.parse<Row>(CSV_URL, {
      download: true, header: true, skipEmptyLines: true,
      complete: (res: ParseResult<Row>) => {
        const clean = (res.data || [])
          .map(r => ({
            festival: norm(r.festival),
            date: norm(r.date),
            stage: norm(r.stage),
            stage_order: Number((r.stage_order as any) ?? 9999),
            artist: norm(r.artist),
            start: norm(r.start),
            end: norm(r.end),
            rating: norm(r.rating || ''),
          }))
          .filter(r => r.festival && r.date && r.stage && r.artist && r.start && r.end);
        setRows(clean);
      }
    });
  }, [CSV_URL]);

  const groups: Group[] = useMemo(() => {
    const map = new Map<string, Group>();
    for (const r of rows) {
      const key = `${r.festival}__${r.date}`;
      if (!map.has(key)) map.set(key, { title: r.festival, date: r.date, rows: [], key });
      map.get(key)!.rows.push(r);
    }
    return Array.from(map.values()).sort((a, b) => parseDate(b.date) - parseDate(a.date));
  }, [rows]);

  async function exportPng(key: string, title: string) {
    const el = refs.current[key]; if (!el) return;
    setErr(null);
    try {
      const dataUrl = await htmlToImage.toPng(el, {
        pixelRatio: 2, backgroundColor: '#ffffff', cacheBust: true, skipFonts: true
      } as any);
      const a = document.createElement('a'); a.href = dataUrl; a.download = `${title.replace(/\s+/g, '_')}.png`; a.click();
    } catch (e: any) { setErr(e?.message || 'Export failed'); console.error(e); }
  }

  return (
    <div className="mx-auto max-w-6xl px-6 py-4">
      {/* 1) header removed */}

      {/* 2) sticky legend */}
      <div className="sticky top-2 z-30 mb-4">
        <div className="inline-flex items-center gap-6 rounded-lg border border-neutral-700 bg-neutral-900/95 px-4 py-2 text-sm text-white shadow-md">
          <span className="inline-flex items-center gap-2">
            <span className="inline-block h-3 w-6 rounded" style={{ backgroundColor: COLORS.nahh }} />
            nahh
          </span>
          <span className="inline-flex items-center gap-2">
            <span className="inline-block h-3 w-6 rounded" style={{ backgroundColor: COLORS.ok }} />
            ok
          </span>
          <span className="inline-flex items-center gap-2">
            <span className="inline-block h-3 w-6 rounded" style={{ backgroundColor: COLORS.hot }} />
            hot
          </span>
          <span className="inline-flex items-center gap-2">
            <span className="inline-block h-3 w-6 rounded" style={{ backgroundColor: COLORS.blazing }} />
            blazing
          </span>
        </div>
      </div>

      {err && <div className="mb-4 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">{err}</div>}

      <div className="space-y-12">
        {groups.map(g => (
          <Heatmap
            key={g.key}
            groupKey={g.key}
            title={g.title}
            date={g.date}
            rows={g.rows}
            pxPerMin={pxPerMin}
            registerRef={el => (refs.current[g.key] = el)}
            onExport={() => exportPng(g.key, `${g.title} ${g.date}`)}
          />
        ))}
      </div>

      <div className="mt-6 flex items-center gap-3 text-xs text-neutral-600">
        <label>density</label>
        <input type="range" min={0.6} max={2.0} step={0.05} value={pxPerMin}
               onChange={e => setPxPerMin(parseFloat((e.target as HTMLInputElement).value))}/>
        <span>{pxPerMin.toFixed(2)} px/min</span>
      </div>
    </div>
  );
}

/* one heatmap */
function Heatmap({
  groupKey, title, date, rows, pxPerMin, registerRef, onExport,
}: {
  groupKey: string; title: string; date: string; rows: Row[];
  pxPerMin: number; registerRef: (el: HTMLDivElement | null) => void; onExport: () => void;
}) {
  const stages = useMemo(() => {
    const map = new Map<string, number>();
    rows.forEach(r => {
      const ord = Number(r.stage_order ?? 9999);
      map.set(r.stage, Math.min(map.get(r.stage) ?? ord, ord));
    });
    return Array.from(map.entries()).sort((a, b) => a[1] - b[1]).map(([s]) => s);
  }, [rows]);

  const minStart = useMemo(() => Math.min(...rows.map(r => toMin(r.start))), [rows]);
  const maxEnd   = useMemo(() => Math.max(...rows.map(r => toMin(r.end))),   [rows]);
  const totalMin = clamp(Math.max(60, maxEnd - minStart), 60, 16 * 60);
  const heightPx = Math.round(totalMin * pxPerMin);

  const hours = useMemo(() => {
    const s = Math.floor(minStart / 60), e = Math.ceil(maxEnd / 60);
    return Array.from({ length: Math.max(0, e - s + 1) }, (_, i) => (s + i) * 60);
  }, [minStart, maxEnd]);

  return (
    <section aria-labelledby={`h-${groupKey}`}>
      <div className="mb-2 flex items-center justify-between">
        <h2 id={`h-${groupKey}`} className="text-2xl font-semibold tracking-wide text-neutral-900">
          {title}
        </h2>
        <div className="flex items-center gap-3">
          <span className="text-sm text-neutral-500">{date}</span>
          <button className="rounded-md border border-neutral-300 bg-white px-3 py-2 text-sm hover:bg-neutral-50" onClick={onExport}>
            Export PNG
          </button>
        </div>
      </div>

      {/* wrapper has no background */}
      <div ref={registerRef} className="rounded-xl border border-neutral-200 p-4">
        {/* headers with vertical black dividers */}
        <div className="flex items-stretch">
          <div style={{ width: TIME_W }} />
          <div className="grid w-full gap-0" style={{ gridTemplateColumns: `repeat(${stages.length}, minmax(0, 1fr))` }}>
            {stages.map((s, i) => (
              <div key={s}
                   className={`text-center text-[13px] font-medium tracking-wide text-neutral-700 border-r border-black ${i === stages.length - 1 ? 'border-r-0' : ''} py-1`}>
                {s}
              </div>
            ))}
          </div>
        </div>

        {/* body */}
        <div className="mt-2 flex items-stretch">
          {/* time rail with ticks and labels moved left from the ticks */}
          <div className="relative" style={{ width: TIME_W, height: heightPx }}>
            {hours.map(h => (
              <div key={`tick-${h}`} className="absolute right-0 h-px bg-black"
                   style={{ top: (h - minStart) * pxPerMin, width: TICK_W }} />
            ))}
            {hours.map(h => (
              <div key={`lab-${h}`} className="absolute -translate-y-3 text-[16px] font-bold tabular-nums text-neutral-900"
                   style={{ top: (h - minStart) * pxPerMin, right: TICK_W + LABEL_GAP }}>
                {String(Math.floor(h / 60)).padStart(2, '0')}:00
              </div>
            ))}
          </div>

          {/* stage area with global grid lines */}
          <div className="relative w-full" style={{ height: heightPx }}>
            {/* black horizontal lines across all stages */}
            <div className="pointer-events-none absolute inset-0">
              {hours.map(h => (
                <div key={`hline-${h}`} className="absolute left-0 right-0 h-px bg-black"
                     style={{ top: (h - minStart) * pxPerMin }} />
              ))}
            </div>

            {/* columns with black vertical separators */}
            <div className="relative grid h-full gap-0" style={{ gridTemplateColumns: `repeat(${stages.length}, minmax(0, 1fr))` }}>
              {stages.map((stage, idx) => {
                const sets = rows.filter(r => r.stage === stage).sort((a, b) => toMin(a.start) - toMin(b.start));
                return (
                  <div key={stage} className={`relative border-r border-black ${idx === stages.length - 1 ? 'border-r-0' : ''}`}>
                    {sets.map((r, i) => {
                      const naturalTop = (toMin(r.start) - minStart) * pxPerMin;
                      const naturalH   = Math.max(28, (toMin(r.end) - toMin(r.start)) * pxPerMin);
                      const innerH = naturalH * 0.95;                                  // 95% height
                      const top = naturalTop + (naturalH - innerH) / 2;

                      const bucket = bucketFromRating(r.rating);
                      const bg = bucket ? COLORS[bucket] : COLORS.unrated;
                      const txt = (bucket === 'ok' || bucket === '') ? '#111827' : '#FFFFFF';

                      return (
                        <div key={stage + '-' + i} className="absolute left-2 right-2" style={{ top }}>
                          <div className={`${CARD_BORDER} flex items-center justify-center text-center px-2`}
                               style={{ height: innerH, backgroundColor: bg, color: txt }}>
                            <div className="text-[13px] leading-snug">{r.artist}</div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}
```

## src/app/layout.tsx

```text
// src/app/layout.tsx
import './globals.css';
import type { ReactNode } from 'react';
import { PlayerProvider } from '@/context/PlayerProvider';
import AppShell from '@/components/AppShell';

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html lang="en">
      <body className="min-h-screen bg-neutral-50 text-neutral-800 font-sans relative overflow-x-hidden">
        {/* light theme variables for any legacy components that still reference them */}
        <style>{`:root{--accent:#2563eb;--label:#737373;--radius:0.75rem;--sodium:#2563eb}`}</style>
        <PlayerProvider>
          <AppShell>{children}</AppShell>
        </PlayerProvider>
      </body>
    </html>
  );
}
```

## src/app/list/page.tsx

```text
// src/app/list/page.tsx
'use client';

import { useMemo, useRef, useState } from "react";
import { useVirtualizer } from "@tanstack/react-virtual";
import { IconButton, PageTitle, Switch, Tag } from "@/components/ui";
import { YouTubeIcon, SCIcon, SearchIcon } from "@/components/icons";
import { usePlayer } from "@/context/PlayerProvider";
import { useRows } from "@/lib/useRows";

const ROW_COLS = "grid grid-cols-[1.5rem_minmax(0,1fr)_auto_auto] items-center gap-3";

export default function ListPage() {
  const { rows, loading } = useRows();
  const { play } = usePlayer();

  const [q, setQ] = useState("");
  const [sOnly, setSOnly] = useState(false);
  const [medium, setMedium] = useState<"any" | "youtube" | "soundcloud">("any");
  const [genre, setGenre] = useState("any");

  const genres = useMemo(() => {
    const s = new Set<string>();
    rows.forEach(r => { const g = (r.classification || "").trim(); if (g) s.add(g); });
    return ["any", ...Array.from(s).sort()];
  }, [rows]);

  const filtered = useMemo(() => {
    const term = q.trim().toLowerCase();
    return rows.filter(r => {
      if (sOnly && (r.tier || "").toUpperCase() !== "S") return false;
      if (genre !== "any" && r.classification !== genre) return false;
      if (medium === "youtube" && !r.youtube) return false;
      if (medium === "soundcloud" && !r.soundcloud) return false;
      if (!term) return true;
      const hay = `${r.set} ${(r.classification || "")} ${(r.tier || "")}`.toLowerCase();
      return term.split(/\s+/).filter(Boolean).every(w => hay.includes(w));
    });
  }, [rows, q, sOnly, genre, medium]);

  const parentRef = useRef<HTMLDivElement | null>(null);
  const rowVirtualizer = useVirtualizer({
    count: loading ? 20 : filtered.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 56,
    overscan: 8,
  });

  return (
    <section className="container mx-auto max-w-6xl px-6 mt-10 space-y-10">
      <PageTitle title="THE LIST" />

      <div className="rounded-2xl border border-neutral-200 overflow-hidden bg-white">
        {/* sticky controls + aligned column labels */}
        <div className="sticky top-20 z-10 bg-white/90 backdrop-blur">
          {/* filters */}
          <div className="flex flex-wrap items-center justify-between gap-3 p-3 border-b border-neutral-200">
            <div className="flex items-center gap-2">
              <span className="text-xs font-medium tracking-widest text-neutral-500">Search</span>
              <label className="flex items-center gap-2 rounded-lg border border-neutral-300 bg-white px-2 h-9">
                <SearchIcon />
                <input value={q} onChange={e => setQ(e.target.value)} className="outline-none text-sm w-56" placeholder="Type to filter" />
              </label>
            </div>
            <div className="flex items-center gap-3">
              <span className="text-xs font-medium tracking-widest text-neutral-500">Genre</span>
              <span className="relative inline-flex items-center h-9 px-3 rounded-lg border border-neutral-300 bg-white">
                <select value={genre} onChange={e => setGenre(e.target.value)} className="appearance-none bg-transparent outline-none text-sm pr-5">
                  {genres.map(g => <option key={g} value={g}>{g}</option>)}
                </select>
                <svg width="16" height="16" viewBox="0 0 20 20" className="absolute right-1 pointer-events-none"><path d="M5 7l5 6 5-6" fill="none" stroke="#000" strokeWidth="1.5" /></svg>
              </span>
            </div>
            <div className="flex items-center gap-3">
              <span className="text-xs font-medium tracking-widest text-neutral-500">Tier</span>
              <Switch checked={sOnly} onChange={() => setSOnly(v => !v)} />
              <span className="text-sm">S-tier only</span>
            </div>
            <div className="flex items-center gap-3">
              <span className="text-xs font-medium tracking-widest text-neutral-500">Format</span>
              <span className="relative inline-flex items-center h-9 px-3 rounded-lg border border-neutral-300 bg-white">
                <select value={medium} onChange={e => setMedium(e.target.value as any)} className="appearance-none bg-transparent outline-none text-sm pr-5">
                  <option value="any">-</option>
                  <option value="youtube">YouTube</option>
                  <option value="soundcloud">SoundCloud</option>
                </select>
                <svg width="16" height="16" viewBox="0 0 20 20" className="absolute right-1 pointer-events-none"><path d="M5 7l5 6 5-6" fill="none" stroke="#000" strokeWidth="1.5" /></svg>
              </span>
            </div>
          </div>
          {/* column labels that align with rows */}
          <div className={`${ROW_COLS} text-xs font-medium text-neutral-500 px-4 py-2 border-b border-neutral-200`}>
            <div className="uppercase tracking-widest">s</div>
            <div className="uppercase tracking-widest">title</div>
            <div className="uppercase tracking-widest">genre</div>
            <div className="uppercase tracking-widest justify-self-end">links</div>
          </div>
        </div>

        {/* scroll area */}
        <div ref={parentRef} className="h-[60vh] overflow-auto">
          <div style={{ height: rowVirtualizer.getTotalSize(), position: "relative" }}>
            {rowVirtualizer.getVirtualItems().map(vi => {
              const r = filtered[vi.index];
              return (
                <div key={vi.key} className="absolute left-0 right-0" style={{ transform: `translateY(${vi.start}px)` }}>
                  {loading ? (
                    <div className={`${ROW_COLS} px-4 py-3 odd:bg-white animate-pulse`}>
                      {Array.from({ length: 4 }).map((_, j) => (<div key={j} className="h-4 w-3/4 bg-neutral-200 rounded" />))}
                    </div>
                  ) : (
                    <div className={`${ROW_COLS} px-4 py-3 odd:bg-white hover:bg-blue-50/40 transition`}>
                      <div className="py-1 font-medium" style={{ fontFamily: "'Space Grotesk',system-ui,sans-serif" }}>{(r?.tier || "").toUpperCase() || "?"}</div>
                      <div className="py-1 min-w-0">
                        <a href={r?.youtube || r?.soundcloud || "#"} className="block truncate hover:underline" title={r?.set}>{r?.set}</a>
                      </div>
                      <div className="py-1"><Tag>{(r?.classification || "").toLowerCase()}</Tag></div>
                      <div className="py-1">
                        <div className="flex items-center gap-2 justify-end">
                          {r?.youtube && (<IconButton title="play on YouTube" ariaLabel="play on YouTube" onClick={() => play(r, 'youtube')}><YouTubeIcon /></IconButton>)}
                          {r?.soundcloud && (<IconButton title="play on SoundCloud" ariaLabel="play on SoundCloud" onClick={() => play(r, 'soundcloud')}><SCIcon /></IconButton>)}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>

        <div className="p-4 text-xs text-neutral-500">data source: published Google Sheet.</div>
      </div>
    </section>
  );
}
```

## src/app/page.tsx

```text
// src/app/page.tsx
'use client';

import React from 'react';
import { usePlayer } from '@/context/PlayerProvider';

type Row = {
  set: string;
  classification?: string | null;
  youtube?: string | null;
  soundcloud?: string | null;
};

function ytId(u?: string | null) {
  if (!u) return null;
  try {
    const url = new URL(u);
    if (url.hostname.includes('youtu.be')) return url.pathname.slice(1);
    if (url.searchParams.get('v')) return url.searchParams.get('v');
    const seg = url.pathname.split('/');
    const i = seg.indexOf('embed');
    if (i >= 0 && seg[i + 1]) return seg[i + 1];
  } catch {}
  return null;
}

function ytThumbs(u?: string | null) {
  const id = ytId(u); if (!id) return [];
  return [
    `https://i.ytimg.com/vi/${id}/maxresdefault.jpg`,
    `https://i.ytimg.com/vi/${id}/sddefault.jpg`,
    `https://i.ytimg.com/vi/${id}/hqdefault.jpg`,
    `https://i.ytimg.com/vi/${id}/mqdefault.jpg`,
  ];
}

function useCollage(max = 5) {
  const [items, setItems] = React.useState<Row[]>([]);
  React.useEffect(() => {
    let ok = true;
    (async () => {
      try {
        const res = await fetch('/api/sheets?tabs=list', { cache: 'no-store' });
        const json = await res.json();
        const rows = (json?.data?.list || []) as Row[];
        const pool = rows.filter(r => r.youtube || r.soundcloud);
        const picked = [...pool].sort(() => Math.random() - 0.5).slice(0, max);
        if (ok) setItems(picked);
      } catch {
        if (ok) setItems([]);
      }
    })();
    return () => { ok = false; };
  }, [max]);
  return items;
}

const PlusIcon = () => (
  <svg className="h-6 w-6 opacity-80" viewBox="0 0 24 24" fill="none" aria-hidden>
    <path d="M4 12h16M12 4v16" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
  </svg>
);
const ListIcon = () => (
  <svg className="h-6 w-6 opacity-80" viewBox="0 0 24 24" fill="none" aria-hidden>
    <path d="M6 7h12M6 12h12M6 17h12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
  </svg>
);
const HeatIcon = () => (
  <svg className="h-6 w-6 opacity-80" viewBox="0 0 24 24" fill="none" aria-hidden>
    <path d="M12 3C9 7 16 9 16 13a4 4 0 1 1-8 0c0-2 1-3 2-4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
  </svg>
);

export default function Home() {
  const collage = useCollage(5);
  const { play } = usePlayer();

  const CSV = encodeURIComponent('https://docs.google.com/spreadsheets/d/e/2PACX-1vRexqa-1vfj-JdFSSFUjWycho-00d5rLdS76eBgvCbruyvtcVIIom-VM52SvfuhLg-CeHLRp2I6k5B2/pub?gid=116583245&single=true&output=csv');

  return (
    <main className="container mx-auto max-w-5xl px-6 pt-10">
      <div className="h-6 sm:h-8" />

      <nav className="grid grid-cols-12 gap-6" role="navigation" aria-label="primary">
        <a href="/suggest" aria-label="Suggest a set. Get served a tailored set"
           className="group relative col-span-12 sm:col-span-4 block rounded-2xl border border-blue-600/60 bg-gradient-to-b from-blue-600 to-blue-700 text-white backdrop-blur px-8 py-10 shadow-[0_10px_30px_rgb(37_99_235_/_0.18)] transform-gpu hover:-translate-y-0.5 hover:shadow-[0_18px_40px_rgb(37_99_235_/_0.25)] active:translate-y-0 active:scale-[.99] transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-200">
          <div className="flex items-start gap-3"><PlusIcon /><div><div className="text-lg font-semibold">Suggest a set</div><div className="text-xs font-medium tracking-widest mt-1 opacity-90">Get served a tailored set</div></div></div>
        </a>

        <a href="/list" aria-label="Show the list. Go through all hand-curated grooves"
           className="group relative col-span-12 sm:col-span-4 block rounded-2xl border border-neutral-200/70 bg-white/70 backdrop-blur shadow-[0_10px_30px_rgb(0_0_0_/_0.06)] px-8 py-10 transform-gpu hover:-translate-y-0.5 hover:shadow-[0_18px_40px_rgb(0_0_0_/_0.10)] hover:border-blue-400/40 active:translate-y-0 active:scale-[.99] transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-200">
          <div className="flex items-start gap-3"><ListIcon /><div><div className="text-lg font-semibold text-neutral-900">Show the list</div><div className="text-xs font-medium tracking-widest text-neutral-500 mt-1">Go through all hand-curated grooves</div></div></div>
        </a>

        <a href={`/heatmaps?csv=${CSV}`} aria-label="Map the heat. Glimpse that festival fire"
           className="group relative col-span-12 sm:col-span-4 block rounded-2xl border border-neutral-200/70 bg-white/70 backdrop-blur shadow-[0_10px_30px_rgb(0_0_0_/_0.06)] px-8 py-10 transform-gpu hover:-translate-y-0.5 hover:shadow-[0_18px_40px_rgb(0_0_0_/_0.10)] hover:border-blue-400/40 active:translate-y-0 active:scale-[.99] transition focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-200">
          <div className="flex items-start gap-3"><HeatIcon /><div><div className="text-lg font-semibold text-neutral-900">Map the heat</div><div className="text-xs font-medium tracking-widest text-neutral-500 mt-1">Glimpse that festival fire</div></div></div>
        </a>
      </nav>

      <h3 className="mt-8 mb-4 text-2xl sm:text-3xl font-semibold tracking-wide">Random serve</h3>

      <section>
        <div className="grid grid-cols-2 sm:grid-cols-5 gap-3">
          {collage
            // render-step filter: only SoundCloud for Random serve
            .filter((r) => !!r.soundcloud && r.soundcloud.includes("soundcloud.com"))
            .map((r, i) => (
              <button
                key={i}
                aria-label={`Play ${r.set}`}
                onClick={() => play(r as any, "soundcloud" as any)}
                className="relative aspect-square rounded-xl overflow-hidden border border-neutral-200/70 bg-white shadow-sm hover:shadow-md hover:border-blue-400/40 transition transform-gpu active:scale-[.99]"
              >
                <SCArtwork url={r.soundcloud!} />
              </button>
            ))}
          {Array.from({ length: Math.max(0, 5 - collage.length) }).map((_, i) => (
            <div key={`ph-${i}`} className="aspect-square rounded-xl border border-neutral-200/60 bg-[radial-gradient(circle_at_30%_30%,#e5e7eb,#fafafa)]" />
          ))}
        </div>
      </section>

      <div className="h-10" />
    </main>
  );
}

function CoverBackground({ urls }: { urls: string[] }) {
  const [idx, setIdx] = React.useState(0);
  const src = urls[idx];
  return (
    <div className="absolute inset-0" style={{ backgroundImage: `url(${src})`, backgroundSize: 'cover', backgroundPosition: 'center' }}>
      <img src={src} alt="" className="hidden" onError={() => { if (idx < urls.length - 1) setIdx(idx + 1); }} />
    </div>
  );
}

function SCArtwork({ url }: { url: string }) {
  const [art, setArt] = React.useState<string | null>(null);
  const [failed, setFailed] = React.useState(false);
  React.useEffect(() => {
    let ok = true;
    (async () => {
      try {
        const res = await fetch(`/api/soundcloud-artwork?url=${encodeURIComponent(url)}`, { cache: "no-store" });
        const json = await res.json();
        if (ok) setArt(json?.artwork || null);
      } catch {
        if (ok) setArt(null);
      }
    })();
    return () => { ok = false; };
  }, [url]);

  if (!art || failed) {
    // fallback gradient when there is no artwork
    return <div className="absolute inset-0 bg-gradient-to-br from-orange-200 to-orange-400" />;
  }
  // default SoundCloud artwork is square; keep tile square via aspect-square on parent
  // eslint-disable-next-line @next/next/no-img-element
  return <img src={art} alt="" className="absolute inset-0 w-full h-full object-cover" onError={() => setFailed(true)} />;
}
```

## src/app/suggest/page.tsx

```text
// src/app/suggest/page.tsx
'use client';

import { useEffect, useMemo, useRef, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { PageTitle, Pill, Switch } from '@/components/ui';
import { YouTubeIcon, SCIcon } from '@/components/icons';
import { useRows } from '@/lib/useRows';
import { usePlayer } from '@/context/PlayerProvider';

type Provider='youtube'|'soundcloud';
type PickItem={row:any;provider:Provider};

const subhdr="text-[13px] font-medium tracking-widest text-neutral-600 uppercase";

/* youtube utilities */
const ytId=(u?:string|null)=>{if(!u) return null;try{const url=new URL(u);if(url.hostname.includes('youtu.be'))return url.pathname.slice(1);if(url.searchParams.get('v'))return url.searchParams.get('v');const p=url.pathname.split('/');const i=p.indexOf('embed');if(i>=0&&p[i+1])return p[i+1];return null;}catch{return null;}};

/* 16:9 thumbnail component with fallbacks to avoid letterboxing */
function YTThumb({url}:{url?:string|null}) {
  const id=ytId(url);
  const order=id?[
    `https://i.ytimg.com/vi/${id}/maxresdefault.jpg`, // 1280x720 if available
    `https://i.ytimg.com/vi/${id}/hq720.jpg`,         // 1280x720 16:9
    `https://i.ytimg.com/vi/${id}/mqdefault.jpg`,     // 320x180 16:9
    `https://i.ytimg.com/vi/${id}/hqdefault.jpg`,     // 480x360 (fallback)
  ]:[];
  const [idx,setIdx]=useState(0);
  const tried = useRef(0);
  if(!id) return null;
  return (
    // eslint-disable-next-line @next/next/no-img-element
    <img src={order[idx]} alt="" className="absolute inset-0 w-full h-full object-cover block"
      onError={()=>{if(tried.current<order.length-1){tried.current++;setIdx(i=>i+1);}}}/>
  );
}

export default function SuggestPage(){
  const { rows }=useRows();
  const { play }=usePlayer();

  // defaults: Any + S-tier off every visit; format persists
  const [genre,setGenre]=useState<'any'|string>('any');
  const [sOnly,setSOnly]=useState(false);
  const [format,setFormat]=useState<'none'|Provider>('none');

  useEffect(()=>{try{
    setGenre((localStorage.getItem('ga_genre') as any)||'any');
    const f=(localStorage.getItem('ga_format')||'none').toLowerCase();
    setFormat(f==='youtube'?'youtube':f==='soundcloud'?'soundcloud':'none');
  }catch{}},[]);
  useEffect(()=>{try{localStorage.setItem('ga_genre',genre);}catch{}},[genre]);
  useEffect(()=>{try{localStorage.setItem('ga_format',format);}catch{}},[format]);

  const genres=useMemo(()=>{const set=new Set(rows.map(r=>(r.classification||'').trim()).filter(Boolean));return [{label:'Any',value:'any' as const},...Array.from(set).sort().map(g=>({label:g,value:g}))];},[rows]);

  const pool=useMemo(()=>rows.filter(r=>{
    if(sOnly&&(r.tier||'').toUpperCase()!=='S')return false;
    if(genre!=='any'&&r.classification!==genre)return false;
    if(format==='youtube')return !!r.youtube;
    if(format==='soundcloud')return !!r.soundcloud;
    return !!(r.youtube||r.soundcloud);
  }),[rows,sOnly,genre,format]);

  const [pick,setPick]=useState<PickItem|null>(null);
  const [isLaunching,setIsLaunching]=useState(false);
  const [hasLaunched,setHasLaunched]=useState(false);

  const chooseProviderForRow=(r:any):Provider=>{
    if(format==='youtube'&&r.youtube)return'youtube';
    if(format==='soundcloud'&&r.soundcloud)return'soundcloud';
    if(r.youtube&&r.soundcloud)return Math.random()<0.5?'youtube':'soundcloud';
    return r.youtube?'youtube':'soundcloud';
  };

  const launch=()=>{
    setIsLaunching(true);
    const chosenRow=[...pool].sort(()=>Math.random()-.5)[0]||null;
    const chosen=chosenRow?{row:chosenRow,provider:chooseProviderForRow(chosenRow)}:null;
    setTimeout(()=>{setPick(chosen);setIsLaunching(false);setHasLaunched(true);},1000);
  };

  const Circle=({selected}:{selected:boolean})=><span className={`inline-block h-3.5 w-3.5 rounded-full border ${selected?'bg-blue-600 border-blue-600':'border-neutral-400 bg-white'}`}/>;
  const CircleOption=({label,value,icon}:{label:string;value:Provider;icon:JSX.Element})=>(
    <button type="button" aria-pressed={format===value} onClick={()=>setFormat(f=>f===value?'none':value)}
      className={`h-8 px-3 rounded-full border text-sm inline-flex items-center gap-2 ${format===value?'bg-neutral-900 text-white border-neutral-900':'bg-white border-neutral-300 hover:bg-neutral-50'}`}>
      <Circle selected={format===value}/>{icon}<span>{label}</span>
    </button>
  );

  const titleOf=(r:any)=>r?.set||r?.title||r?.name||'Untitled set';
  const labelOf=(r:any)=> (r?.classification||'').trim();

  return (
    <section className="container mx-auto max-w-6xl px-6 mt-10 space-y-8">
      <PageTitle title="SUGGESTOR"/>

      {/* compact controls */}
      <div className="rounded-3xl border border-neutral-200 bg-neutral-50/60 backdrop-blur p-5 max-w-4xl mx-auto">
        <div className="grid sm:grid-cols-2">
          <div className="relative p-4 sm:pr-6 flex flex-col gap-6">
            <div>
              <div className={subhdr} style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>Genre</div>
              <div className="mt-2 flex flex-wrap justify-center sm:justify-start gap-2">
                {genres.map(g=><Pill key={g.value} active={genre===g.value} onClick={()=>setGenre(g.value)}>{g.label}</Pill>)}
              </div>
            </div>
            <div>
              <div className={subhdr} style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>Format</div>
              <div className="mt-2 flex gap-2">
                <CircleOption label="YouTube" value="youtube" icon={<YouTubeIcon/>}/>
                <CircleOption label="SoundCloud" value="soundcloud" icon={<SCIcon/>}/>
              </div>
            </div>
            <div className="hidden sm:block absolute right-0 top-2 bottom-2 w-px bg-neutral-200"/>
          </div>

          <div className="p-4 sm:pl-6 flex flex-col gap-6">
            <div>
              <div className={subhdr} style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>Tier</div>
              <div className="mt-2 flex items-center gap-3">
                <Switch checked={sOnly} onChange={()=>setSOnly(v=>!v)}/><span className="text-sm">S-tier only</span>
              </div>
            </div>
            <div>
              <div className={subhdr} style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>Launch</div>
              <motion.button onClick={launch}
                whileHover={{y:-1,scale:1.02,boxShadow:"0 10px 20px rgba(37,99,235,.25)"}}
                whileTap={{y:0,scale:0.98,boxShadow:"0 4px 8px rgba(37,99,235,.18)"}}
                className="mt-2 inline-flex h-11 px-6 rounded-full bg-[var(--accent)] text-white leading-none items-center justify-center select-none">
                {hasLaunched?'Go again!':'Go'}
              </motion.button>
            </div>
          </div>
        </div>
      </div>

      {/* pulse overlay */}
      <AnimatePresence>
        {isLaunching&&(
          <motion.div className="fixed inset-0 z-40 pointer-events-none"
            initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}
            style={{background:"radial-gradient(1200px 1200px at 50% 50%, rgba(0,0,0,0.18), transparent 60%)"}}>
            <div className="absolute inset-0 grid place-items-center">
              {[0,1,2].map(i=>(
                <motion.div key={i} initial={{scale:.6,opacity:.55}}
                  animate={{scale:[.6,1.2,1.9],opacity:[.55,.85,0]}}
                  transition={{duration:1,ease:"easeInOut",delay:i*.08}}
                  className="rounded-full border border-black/30" style={{width:240+i*140,height:240+i*140}}/>
              ))}
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* suggestion */}
      {!isLaunching&&pick&&(
        <div className="max-w-4xl mx-auto">
          <motion.article whileHover={{y:-2}}
            className="rounded-2xl border border-neutral-200 overflow-hidden bg-white"
            onClick={()=>play(pick.row,pick.provider)} role="button" aria-label="play suggestion">
            <div className="relative w-full aspect-video bg-neutral-200">
              {pick.provider==='youtube'
                ? <YTThumb url={pick.row.youtube}/>
                : <div className="absolute inset-0 bg-gradient-to-br from-orange-200 to-orange-400 grid place-items-center"><SCIcon/></div>}
              <div className="absolute inset-0 grid place-items-center">
                <div className="rounded-full bg-white/90 border border-neutral-300 w-14 h-14 grid place-items-center">
                  {pick.provider==='youtube'?<YouTubeIcon/>:<SCIcon/>}
                </div>
              </div>
            </div>
          </motion.article>

          {/* big title and label (no dot) */}
          <div className="px-1 pt-4 text-center">
            <h3 className="text-2xl font-semibold break-words" style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>
              {titleOf(pick.row)}
            </h3>
            {labelOf(pick.row) && (
              <div className="mt-1 text-2xl font-semibold" style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>
                {labelOf(pick.row)}
              </div>
            )}
          </div>
        </div>
      )}
    </section>
  );
}
```

## src/components/AppShell.tsx

```text
// src/components/AppShell.tsx
'use client';

import { ReactNode, useMemo } from 'react';
import { usePathname, useRouter } from 'next/navigation';
import { Fonts, WordmarkHeader } from '@/components/Header';
import CommandBar from '@/components/CommandBar';
import NowPlayingBar from '@/components/NowPlayingBar';
import PlayerModal from '@/components/PlayerModal';
import ScrollTopFab from '@/components/ScrollTopFab';
import { useRows } from '@/lib/useRows';

type Route = 'home'|'list'|'suggest'|'heatmaps';
const routeFromPath = (p: string): Route => p.startsWith('/list') ? 'list' : p.startsWith('/suggest') ? 'suggest' : p.startsWith('/heatmaps') ? 'heatmaps' : 'home';

export default function AppShell({ children }: { children: ReactNode }) {
  const pathname = usePathname() || '/';
  const route = useMemo(() => routeFromPath(pathname), [pathname]);
  const router = useRouter();
  const { rows } = useRows();

  const onNavigate = (r: Route) => router.push(r === 'home' ? '/' : `/${r}`);

  return (
    <>
      <Fonts />
      <WordmarkHeader />
      {children}
      <CommandBar rows={rows} onNavigate={onNavigate} />
      <ScrollTopFab />
      <NowPlayingBar />
      <PlayerModal />
    </>
  );
}
```

## src/components/CommandBar.tsx

```text
'use client';
import { useEffect, useMemo, useRef, useState } from "react";
import { AnimatePresence, motion } from "framer-motion";
import { usePlayer } from "@/context/PlayerProvider";
import type { Row } from "@/lib/types";
import { SearchIcon } from "@/components/icons";
import { copyToClipboard } from "@/lib/utils";

export default function CommandBar({ rows, onNavigate }: { rows: Row[]; onNavigate: (r: 'home'|'list'|'suggest'|'heatmaps') => void }) {
  const [open,setOpen]=useState(false); const [q,setQ]=useState(""); const inputRef=useRef<HTMLInputElement|null>(null); const [sel,setSel]=useState(0);
  const { play, enqueue }=usePlayer();
  useEffect(()=>{const onKey=(e:KeyboardEvent)=>{if(e.key.toLowerCase()==="k"&&!e.metaKey&&!e.ctrlKey&&!e.altKey){e.preventDefault();setOpen(v=>!v);} if(e.key==="Escape") setOpen(false);}; window.addEventListener("keydown",onKey); return()=>window.removeEventListener("keydown",onKey);},[]);
  useEffect(()=>{if(open) setTimeout(()=>inputRef.current?.focus(),0); else{setQ("");setSel(0);}},[open]);
  const filtered=useMemo(()=>{const term=q.toLowerCase().trim(); const base=term?rows.filter(r=>r.set.toLowerCase().includes(term)||(r.classification||"").toLowerCase().includes(term)):rows; return base.slice(0,8);},[q,rows]);
  const onKeyDown=(e:React.KeyboardEvent)=>{if(e.key==="ArrowDown"){setSel(i=>Math.min(i+1,filtered.length-1));e.preventDefault();} if(e.key==="ArrowUp"){setSel(i=>Math.max(i-1,0));e.preventDefault();} if(e.key==="Enter"){const row=filtered[sel]; if(!row) return; if(e.metaKey||e.ctrlKey){const t=row.youtube||row.soundcloud||"#"; window.open(t,"_blank","noopener,noreferrer");} else {play(row); setOpen(false);}}};
  return (<AnimatePresence>{open&&(<motion.div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} onClick={()=>setOpen(false)}><motion.div className="mx-auto mt-24 w-[92vw] max-w-2xl rounded-2xl border border-white/10 bg-[var(--ash)]/60 backdrop-blur-xl overflow-hidden" initial={{y:10,opacity:0}} animate={{y:0,opacity:1}} exit={{y:10,opacity:0}} onClick={e=>e.stopPropagation()}><div className="flex items-center gap-2 px-4 py-3 border-b border-white/10"><SearchIcon/><input ref={inputRef} value={q} onChange={e=>setQ(e.target.value)} onKeyDown={onKeyDown} placeholder="type to search sets or jump to a page" className="w-full bg-transparent outline-none placeholder-white/50"/><kbd className="text-xs bg-white/5 border border-white/10 px-2 py-1 rounded-md">esc</kbd></div><div className="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-white/10"><div className="max-h-[40vh] overflow-auto"><div className="px-4 py-2 text-xs uppercase tracking-widest opacity-70">pages</div>{[{label:"Home",action:()=>onNavigate("home")},{label:"The list",action:()=>onNavigate("list")},{label:"Suggest me a set",action:()=>onNavigate("suggest")},{label:"Heatmaps",action:()=>onNavigate("heatmaps")}].map(it=>(<button key={it.label} onClick={()=>{it.action();setOpen(false);}} className="w-full text-left px-4 py-2 hover:bg-white/10">{it.label}</button>))}</div><div className="max-h-[40vh] overflow-auto"><div className="px-4 py-2 text-xs uppercase tracking-widest opacity-70">sets</div>{filtered.map((r,i)=>(<div key={r.set} className={`px-4 py-2 ${i===sel?"bg-white/10":"hover:bg-white/10"}`} onMouseEnter={()=>setSel(i)}><div className="flex items-center justify-between gap-2"><div className="min-w-0"><div className="font-medium truncate">{r.set}</div><div className="text-xs opacity-70 capitalize truncate">{(r.classification||"").toLowerCase()||"unknown"}</div></div><div className="flex items-center gap-2 shrink-0"><button className="btn-secondary" onClick={()=>enqueue(r)}>queue</button><button className="btn-secondary" onClick={()=>copyToClipboard(r.youtube||r.soundcloud||"")}>copy</button><button className="btn-secondary" onClick={()=>{const t=r.youtube||r.soundcloud||"#"; window.open(t,"_blank","noopener,noreferrer");}}>open</button></div></div></div>))}{filtered.length===0&&<div className="px-4 py-3 text-sm opacity-70">no results</div>}</div></div></motion.div></motion.div>)}</AnimatePresence>);
}
```

## src/components/Header.tsx

```text
// src/components/Header.tsx
'use client';
import Link from 'next/link';

export function Fonts() {
  return (
    <>
      <link rel="preconnect" href="https://fonts.googleapis.com"/>
      <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin=""/>
      <link rel="preconnect" href="https://i.ytimg.com"/>{/* speed up thumbs */}
      <link rel="preconnect" href="https://i1.sndcdn.com"/>{/* speed up SC thumbs */}
      <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700;900&display=swap" rel="stylesheet"/>
    </>
  );
}

export function WordmarkHeader() {
  return (
    <header className="pt-8">
      <style>{`
        .wmk{position:relative;display:inline-block}
        .wmk::before,.wmk::after{content:"";position:absolute;left:50%;top:50%;border-radius:9999px;pointer-events:none;opacity:0;filter:blur(22px)}
        .wmk::before{width:200%;height:300%;transform:translate(-50%,-50%) scale(.94);background:radial-gradient(closest-side,rgba(37,99,235,.48),transparent 74%)}
        .wmk::after{width:150%;height:200%;transform:translate(-50%,-50%) scale(.94);background:radial-gradient(closest-side,rgba(37,99,235,.76),transparent 72%)}
        .wmk:hover::before,.wmk:hover::after{opacity:1;animation:heartbeat .9s ease-in-out infinite}
        @keyframes heartbeat{0%,100%{transform:translate(-50%,-50%) scale(.96)}25%{transform:translate(-50%,-50%) scale(1.14)}55%{transform:translate(-50%,-50%) scale(1.01)}}
      `}</style>

      <div className="container mx-auto max-w-6xl px-6">
        <div className="text-center">
          <Link href="/" className="wmk cursor-pointer select-none" aria-label="Go to home">
            <span className="text-2xl sm:text-3xl font-semibold tracking-[0.25em] inline-block" style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>
              THE GROOVE ARCHIVE
            </span>
          </Link>
        </div>
        <div className="mt-4 h-px bg-gradient-to-r from-transparent via-black/30 to-transparent"/>
      </div>
    </header>
  );
}
```

## src/components/icons.tsx

```text
'use client';
export const SearchIcon=()=>(<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" strokeWidth="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" strokeWidth="2"/></svg>);
export const PlayIcon=()=>(<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>);
export const ArrowUpIcon=()=>(<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5l7 7h-4v7H9v-7H5z"/></svg>);
export const YouTubeIcon=()=>(<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden><path d="M23.5 6.2s-.2-1.6-.8-2.3c-.7-.8-1.5-.8-1.9-.9C17.8 2.6 12 2.6 12 2.6s-5.8 0-8.7.4c-.4 0-1.2.1-1.9.9C.7 4.6.5 6.2.5 6.2S0 8.1 0 10v1.9c0 1.9.5 3.8.5 3.8s.2 1.6.8 2.3c.7.8 1.7.7 2.2.8 1.6.2 6.5.4 8.5.4s6.9-.1 8.5-.4c.5-.1 1.5 0 2.2-.8.6-.7.8-2.3.8-2.3S24 13.8 24 11.9V10c0-1.9-.5-3.8-.5-3.8zM9.6 14.6V7.9l6.3 3.4-6.3 3.3z"/></svg>);
export const SCIcon=({className}:{className?:string})=>(<svg className={className} width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden><path d="M17.7 10.1c-.4 0-.8.1-1.2.2-.6-2.4-2.7-4.2-5.3-4.2-1 0-1.9.3-2.7.7-.3.1-.4.4-.4.7v8c0 .4.3.7.7.7h8.9c2 0 3.7-1.6 3.7-3.7 0-2-1.7-3.4-3.7-3.4zM3.5 8.2c-.4 0-.7.3-.7.7v7c0 .4.3.7.7.7s.7-.3.7-.7v-7c0-.4-.3-.7-.7-.7zm2 1.4c-.4 0-.7.3-.7.7v5.6c0 .4.3.7.7.7s.7-.3.7-.7V10.3c0-.4-.3-.7-.7-.7zm2 1.2c-.4 0-.7.3-.7.7v4.4c0 .4.3.7.7.7s.7-.3.7-.7v-4.4c0-.4-.3-.7-.7-.7z"/></svg>);
```

## src/components/NowPlayingBar.tsx

```text
'use client';
import { usePlayer } from "@/context/PlayerProvider";
import { PlayIcon } from "@/components/icons";

export default function NowPlayingBar(){
  const { current, playing, toggle, next, queue, setOpen }=usePlayer(); if(!current) return null;
  return (<div className="fixed bottom-0 left-0 right-0 z-40 px-3 md:px-6 pb-3"><div className="mx-auto max-w-4xl rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md"><div className="flex items-center gap-3 px-3 py-2">
    <button className="w-8 h-8 rounded-full bg-[var(--sodium)]/20 border border-[var(--sodium)]/60 grid place-items-center" onClick={toggle} aria-label="toggle play">{playing?(<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>):(<PlayIcon/>)}</button>
    <div className="flex-1 min-w-0"><div className="truncate text-sm font-semibold">{current.row.set}</div><div className="text-xs opacity-70 capitalize">{(current.row.classification||"").toLowerCase()}</div></div>
    <div className="flex items-center gap-2"><span className="text-xs opacity-70">{current.provider}</span><button className="btn-secondary" onClick={()=>setOpen(true)}>open</button><button className="btn-secondary" onClick={next} disabled={queue.length===0}>next</button></div>
  </div></div></div>);
}
```

## src/components/PlayerModal.tsx

```text
'use client';
import { AnimatePresence, motion } from "framer-motion";
import { usePlayer } from "@/context/PlayerProvider";
import { ytid } from "@/lib/utils";

const YouTubeFrame=({url}:{url:string})=>{const id=ytid(url)||""; const origin=typeof window!=="undefined"?window.location.origin:""; const src=`https://www.youtube.com/embed/${id}?autoplay=1&rel=0&modestbranding=1&origin=${encodeURIComponent(origin)}`; return <iframe title="YouTube player" src={src} className="w-full h-full" allow="autoplay; encrypted-media; picture-in-picture" allowFullScreen/>;};
const SoundCloudFrame=({url}:{url:string})=>{const src=`https://w.soundcloud.com/player/?url=${encodeURIComponent(url)}&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&visual=true`; return <iframe title="SoundCloud player" src={src} className="w-full h-full" allow="autoplay; encrypted-media"/>;};

export default function PlayerModal(){
  const { current, open, setOpen }=usePlayer();
  return (<AnimatePresence>{open&&current&&(<motion.div className="fixed inset-0 z-50 bg-black/75 backdrop-blur-sm grid place-items-center p-4" onClick={()=>setOpen(false)} initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}>
    <motion.div className="w-full max-w-4xl aspect-video bg-black rounded-xl overflow-hidden border border-white/10 shadow-2xl" onClick={e=>e.stopPropagation()} initial={{y:10,opacity:0}} animate={{y:0,opacity:1}} exit={{y:10,opacity:0}}>
      {current.provider==="youtube"?<YouTubeFrame url={current.row.youtube!}/>:<SoundCloudFrame url={current.row.soundcloud!}/>}
    </motion.div></motion.div>)}</AnimatePresence>);
}
```

## src/components/ScrollTopFab.tsx

```text
// src/components/ScrollTopFab.tsx
'use client';

import { useEffect, useState } from 'react';
import { motion } from 'framer-motion';
import { ArrowUpIcon } from '@/components/icons';

export default function ScrollTopFab() {
  const [show, setShow] = useState(false);
  useEffect(() => {
    const onScroll = () => setShow(window.scrollY > 600);
    window.addEventListener('scroll', onScroll);
    return () => window.removeEventListener('scroll', onScroll);
  }, []);
  if (!show) return null;
  return (
    <motion.button
      onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
      className="fixed bottom-6 left-6 z-40 p-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10"
      initial={{ opacity: 0, y: 8 }}
      animate={{ opacity: 1, y: 0 }}
      aria-label="scroll to top"
    >
      <ArrowUpIcon />
    </motion.button>
  );
}
```

## src/components/Thumb.tsx

```text
'use client';
import { useState } from "react";
import type { Row } from "@/lib/types";
import { ytid } from "@/lib/utils";
import { PlayIcon, SCIcon } from "@/components/icons";

export default function Thumb({ row }: { row: Row }) {
  const id=ytid(row.youtube||undefined); const [loaded,setLoaded]=useState(false);
  if(id){const src=`https://img.youtube.com/vi/${id}/hqdefault.jpg`; return (<div className="relative w-full aspect-video overflow-hidden"><img src={src} alt={row.set} loading="lazy" onLoad={()=>setLoaded(true)} className={`w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.03] ${loaded?"blur-0":"blur-md"}`}/><div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-80"/><div className="absolute inset-0 flex items-center justify-center"><div className="w-12 h-12 rounded-full bg-[var(--sodium)]/20 border border-[var(--sodium)]/60 grid place-items-center backdrop-blur-sm group-hover:shadow-[0_0_22px_rgba(183,255,46,0.3)] transition"><PlayIcon/></div></div></div>);}
  return (<div className="relative w-full aspect-video bg-gradient-to-br from-orange-600/40 to-fuchsia-600/30 grid place-items-center overflow-hidden"><div className="absolute inset-0 opacity-30 mix-blend-overlay" style={{backgroundImage:"radial-gradient(ellipse at center, transparent 50%, black 100%)"}}/><SCIcon className="w-12 h-12 opacity-80"/></div>);
}
```

## src/components/ui.tsx

```text
// src/components/ui.tsx
'use client';
import type { ReactNode } from "react";

export function PageTitle({title}:{title:string}) {
  return <h2 className="text-center text-4xl sm:text-5xl font-semibold tracking-wide" style={{fontFamily:"'Space Grotesk',system-ui,sans-serif"}}>{title}</h2>;
}

export function IconButton({title,onClick,ariaLabel,children}:{title:string;onClick?:()=>void;ariaLabel?:string;children:ReactNode;}) {
  return (
    <button title={title} aria-label={ariaLabel||title} onClick={onClick}
      className="w-8 h-8 grid place-items-center rounded-full border border-neutral-300 bg-white hover:bg-neutral-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">
      {children}
    </button>
  );
}

export function Pill({active,children,onClick}:{active:boolean;children:ReactNode;onClick:()=>void}) {
  return <button onClick={onClick} className={`h-7 px-3 rounded-full border text-sm ${active?"bg-neutral-900 text-white border-neutral-900":"bg-white border-neutral-300 hover:bg-neutral-50"}`}>{children}</button>;
}

export function Tag({children}:{children:ReactNode}) {
  return <span className="inline-flex items-center h-6 px-2 rounded-full border border-neutral-300 text-[12px] bg-white">{children}</span>;
}

/* improved spacing and travel */
export function Switch({checked,onChange}:{checked:boolean;onChange:()=>void}) {
  return (
    <button role="switch" aria-checked={checked} onClick={onChange}
      className={`relative inline-flex items-center w-12 h-7 rounded-full border transition
      ${checked?"bg-[var(--accent)] border-[var(--accent)]":"bg-neutral-200 border-neutral-300"} hover:brightness-[.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300`}>
      <i className={`absolute top-[4px] left-[4px] h-[18px] w-[18px] rounded-full bg-white shadow-sm transition-transform
        ${checked?"translate-x-[20px]":""}`}/>
    </button>
  );
}
```

## src/config.ts

```typescript
export const HEATMAP_IMAGES: { title: string; src: string; placeholder?: string }[] = [
  // { title: "Dekmantel 2025  Saturday", src: "/heatmaps/dekmantel-2025-sat.png" },
];
```

## src/context/PlayerProvider.tsx

```text
'use client';
import { createContext, useContext, useEffect, useState, useCallback, type ReactNode } from "react";
import type { Provider, Row } from "@/lib/types";

type QueueItem={row:Row;provider:Provider};
type PlayerState={current:QueueItem|null;queue:QueueItem[];playing:boolean;progress:number;open:boolean;play:(row:Row,preferred?:Provider)=>void;toggle:()=>void;enqueue:(row:Row,preferred?:Provider)=>void;next:()=>void;setOpen:(v:boolean)=>void;};
const Ctx=createContext<PlayerState|null>(null);
export const usePlayer=()=>{const v=useContext(Ctx); if(!v) throw new Error("Player provider missing"); return v;};

const pick=(row:Row,preferred?:Provider):Provider=>preferred==='youtube'&&row.youtube?'youtube':preferred==='soundcloud'&&row.soundcloud?'soundcloud':row.soundcloud?'soundcloud':'youtube';

export function PlayerProvider({children}:{children:ReactNode}){
  const [current,setCurrent]=useState<QueueItem|null>(null),[queue,setQueue]=useState<QueueItem[]>([]),[playing,setPlaying]=useState(false),[progress,setProgress]=useState(0),[open,setOpen]=useState(false);
  useEffect(()=>{if(!playing)return;let raf=0,last=performance.now();const step=(now:number)=>{const dt=(now-last)/1000;last=now;setProgress(p=>(p+dt/1800)%1);raf=requestAnimationFrame(step);};raf=requestAnimationFrame(step);return()=>cancelAnimationFrame(raf);},[playing]);
  const play=useCallback((row:Row,preferred?:Provider)=>{setCurrent({row,provider:pick(row,preferred)});setPlaying(true);setOpen(true);},[]);
  const toggle=useCallback(()=>setPlaying(v=>!v),[]);
  const enqueue=useCallback((row:Row,preferred?:Provider)=>setQueue(q=>[...q,{row,provider:pick(row,preferred)}]),[]);
  const next=useCallback(()=>setQueue(q=>{const n=q[0]; if(n){setCurrent(n);setPlaying(true);setOpen(true);return q.slice(1);} setPlaying(false);return q;}),[]);
  useEffect(()=>{document.documentElement.style.setProperty("--playPulse",playing?"1":"0");},[playing]);
  return <Ctx.Provider value={{current,queue,playing,progress,open,play,toggle,enqueue,next,setOpen}}>{children}</Ctx.Provider>;
}
```

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

## Statistics

- Total Files: 26
- Total Characters: 66307
- Total Tokens: 0
